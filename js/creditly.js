var Creditly=function(){var e,t,r,n,a,u,i,c,o=function(e,t){var r=document.querySelector(t).value.trim();return r+=String.fromCharCode(e.which),s(r)},s=function(e){return e.replace(/[^\d]/g,"")},d=function(e){e.className=e.className.replace(/\bhas-error\b/,"")},l=function(e,t,r){return e.preventDefault(),n=e,!!/^\d+$/.test(String.fromCharCode(n.which));var n},v=function(e){return e.match("^(34|37)")},m=function(e,t,r){var n,a,u=e.currentTarget;return n=t,o(e,r).length>n?(e.preventDefault(),!1):u.selectionStart===u.value.length&&(!((a=e).metaKey||a.ctrlKey||32!==a.which&&(0===a.which||a.which<33))&&l(e))},p={createCvvInput:function(e,t){document.querySelector(e).addEventListener("keypress",function(r){var n=document.querySelector(e);d(n);var a=o(r,t),u=o(r,e),i=v(a),c=i?4:3;m(r,c,e)&&(n.value=u)})}},g=(e=[4,10,15],t=[4,8,12,16],r=function(e,t){for(var r=[],n=0,a=0;a<t.length;a++){if(!(e.length>t[a])){a<t.length?r.push(e.slice(n,t[a])):r.push(e.slice(n));break}r.push(e.slice(n,t[a])),n=t[a]}return r.length>0?r.join(" "):e},{createNumberInput:function(n){document.querySelector(n).addEventListener("keypress",function(a){var u=document.querySelector(n);d(u);var i=o(a,n),c=v(i),s=c?15:16;if(m(a,s,n)){var l;l=r(i,c?e:t),u.value=l;var p=document.createEvent("HTMLEvents");p.initEvent("changed_input",!0,!0),u.dispatchEvent(p)}})}}),f=(n=/(\d\d)\s*\/\s*(\d\d)/,a=function(e){return 15==e.length},u=function(e){if(0===e.length)return!1;if(/[^0-9-\s]+/.test(e))return!1;for(var t=0,r=0,n=!1,a=e.length-1;a>=0;a--){var u=e.charAt(a);r=parseInt(u,10);n&&(r*=2)>9&&(r-=9),t+=r,n=!n}return t%10==0},i={creditCard:function(e,t){var r,n,i=document.querySelector(t.creditCardNumberSelector).value.trim().replace(/\D/g,""),c=[],o=!0,s=[];if(u(i)||(c.push(t.message.number),s.push(t.creditCardNumberSelector),o=!1),t.cvvSelector){var d=document.querySelector(t.cvvSelector).value.trim().replace(/\D/g,"");r=a(i),n=d,r&&4==n.length||!r&&3==n.length||(c.push(t.message.security_code),s.push(t.cvvSelector),o=!1)}return result={is_valid:o,output_value:[i,d],selectors:s,messages:c},result},creditCardExpiration:function(e,t){var r=document.querySelector(e).value.trim(),a=n.exec(r),u=!1,i=["",""];if(a&&3===a.length){var c=parseInt(a[1],10),o=parseInt("20"+a[2],10);c>=0&&c<=12&&(u=!0,i=[c,o])}return{is_valid:u,messages:[t.message],output_value:i}}},c=function(e,t,r,n){if(t.hasOwnProperty(e)){var a=t[e],u=a.type,c=(a.name,i[u](e,a.data));if(!c.is_valid)return r.addError(e,c),!0;if(a.output_name instanceof Array)for(var o=0;o<a.output_name.length;o++)n.addOutput(a.output_name[o],c.output_value[o]);else n.addOutput(a.output_name,c.output_value)}},{validate:function(e){var t,r,n,a=(t=[],r=[],{addError:function(e,n){n.hasOwnProperty("selectors")?r=r.concat(n.selectors):r.push(e),t=t.concat(n.messages)},triggerErrorMessage:function(){for(var e={selectors:r,messages:t},n=0;n<r.length;n++)document.querySelector(r[n]).className=document.querySelector(r[n]).className+" has-error";if(window.jQuery)window.jQuery("body").trigger("creditly_client_validation_error",e);else{var a=document.createEvent("MessageEvent");a.initMessageEvent("creditly_client_validation_error",!0,!0,e,"","","",null),document.body.dispatchEvent(a)}}}),u=(n={},{addOutput:function(e,t){for(var r=e.split("."),a=n,u=0;u<r.length;u++)a.hasOwnProperty(r[u])||(a[r[u]]={}),u===r.length-1?a[r[u]]=t:a=a[r[u]]},getOutput:function(){return n}}),i=!1;for(var o in e)c(o,e,a,u)&&(i=!0);return i?(a.triggerErrorMessage(),!1):u.getOutput()}}),h={createExpirationInput:function(e){document.querySelector(e).addEventListener("keypress",function(t){var r=document.querySelector(e);if(d(r),m(t,4,e)){var n=o(t,e);if(n.length>=2){var a=n.slice(0,2)+" / "+n.slice(2);r.value=a}else r.value=n}})}},y={changeCardType:function(e,t){var r=document.querySelector(e),n=function(r){var n,a=document.querySelector(e).value,u=(n=s(a),/^(34|37)/.test(n)?"American Express":/^4/.test(n)?"Visa":/^5[0-5]/.test(n)?"MasterCard":/^(6011|622|64[4-9]|65)/.test(n)?"Discover":"");document.querySelector(t).innerHTML=u};r.addEventListener("changed_input",n),r.addEventListener("keypress",n),r.addEventListener("keydown",n),r.addEventListener("keyup",n)}},_=function(e,t,r,n){var a=n||{};a.security_code_message=a.security_code_message||"Your security code is invalid",a.number_message=a.number_message||"Your credit card number is invalid",a.expiration_message=a.expiration_message||"Your credit card expiration is invalid";var u={};return u[t]={type:"creditCard",data:{cvvSelector:r,creditCardNumberSelector:t,message:{security_code:a.security_code_message,number:a.number_message}},output_name:["number","security_code"]},u[e]={type:"creditCardExpiration",data:{message:a.expiration_message},output_name:["expiration_month","expiration_year"]},u};return{initialize:function(e,t,r,n,a){var u=_(e,t,r,a);return h.createExpirationInput(e),g.createNumberInput(t),r&&p.createCvvInput(r,t),n&&y.changeCardType(t,n),{validate:function(){return f.validate(u)}}}}}();